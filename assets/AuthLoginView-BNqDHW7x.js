import{z as u,o as f,c as E,s as A,d as w,g as b,p as y,w as i,e as n,u as t,I as v,x as p,G as S,W as $,f as g,t as h,_ as U,h as k,y as D,A as F,b as B,B as V,E as C}from"./index-CGlgPuEt.js";import{u as N}from"./typedRouter.composable-MlTZWMT6.js";import{_ as T,a as q}from"./AuthFormSubmitButton.vue_vue_type_script_setup_true_lang-C5MdiOmZ.js";import{_ as G}from"./_plugin-vue_export-helper-5heKHmp9.js";import{_ as R}from"./AppTypedRouterLink.vue_vue_type_script_setup_true_lang-BavXSOY7.js";(function(){try{var o=typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{},e=new Error().stack;e&&(o._sentryDebugIds=o._sentryDebugIds||{},o._sentryDebugIds[e]="ee55b9d9-6ce9-49cb-8a8a-51c89d0e0786",o._sentryDebugIdIdentifier="sentry-dbid-ee55b9d9-6ce9-49cb-8a8a-51c89d0e0786")}catch{}})();const j=u.object({email:u.string().email(),password:u.string().min(1)}),z={},P={class:"flex flex-col gap-y-2"};function W(o,e){return f(),E("div",P,[A(o.$slots,"default")])}const H=G(z,[["render",W]]),J=w({__name:"AuthLoginForm",props:{form:{},lastLoggedInUser:{}},setup(o){var c;const e=o,{t:r}=b(),s=e.form.register("email",(c=e.lastLoggedInUser)==null?void 0:c.email),d=e.form.register("password");return(l,_)=>(f(),y(U,{form:l.form},{default:i(()=>[n(H,null,{default:i(()=>[n(t(v),p(t(s),{"is-required":!0,label:t(r)("form.fields.email"),placeholder:"email@example.com",type:"email"}),null,16,["label"]),n(t(S),p(t(d),{"is-required":!0,label:t(r)("form.fields.password"),placeholder:t(r)("form.fields.password")}),null,16,["label","placeholder"]),n(R,{to:{name:"forgot-password"},class:"py-2"},{default:i(()=>[n(t($),{class:"font-medium text-primary",variant:"subtext"},{default:i(()=>[g(h(t(r)("auth.login.forgot_password")),1)]),_:1})]),_:1})]),_:1}),n(T,{form:l.form},{default:i(()=>[g(h(t(r)("auth.login.log_in")),1)]),_:1},8,["form"])]),_:1},8,["form"]))}}),Y=w({__name:"AuthLoginView",setup(o){const e=k(),{lastLoggedInUser:r}=D(e),{t:s}=b(),d=C(),c=N(),{form:l,onSubmitForm:_}=F({schema:j}),I=B(()=>r.value===null?s("auth.login.log_in"):s("auth.login.welcome_back_name",{name:r.value.firstName}));async function L(a){e.setLastLoginAttemptEmail(null),e.setLastLoggedInUser(a),await c.replace({name:"index"})}function x(a){if(a instanceof V)l.addErrors({password:{_errors:[s("auth.login.invalid_email_or_password")]}}),d.error({description:s("auth.login.error_toast.description"),title:s("auth.login.error_toast.title")});else throw a}return _(async a=>{try{await e.login(a);const m=await e.getCurrentUser();await L(m)}catch(m){x(m),e.setLastLoginAttemptEmail(a.email)}}),(a,m)=>(f(),y(q,{description:t(s)("auth.login.sign_in_to_continue"),title:I.value},{default:i(()=>[n(J,{form:t(l),"last-logged-in-user":t(r)},null,8,["form","last-logged-in-user"])]),_:1},8,["description","title"]))}});export{Y as default};
