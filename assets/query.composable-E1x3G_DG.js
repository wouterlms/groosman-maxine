var K=(i,t,e)=>{if(!t.has(i))throw TypeError("Cannot "+e)};var s=(i,t,e)=>(K(i,t,"read from private field"),e?e.call(i):t.get(i)),c=(i,t,e)=>{if(t.has(i))throw TypeError("Cannot add the same private member more than once");t instanceof WeakSet?t.add(i):t.set(i,e)},d=(i,t,e,r)=>(K(i,t,"write to private field"),r?r.call(i,e):t.set(i,e),e);var p=(i,t,e)=>(K(i,t,"access private method"),e);import{S as St,L as q,ai as Ct,aj as dt,ak as ft,al as Qt,am as wt,an as Et,ao as pt,O as Ut,b as E,P as It,Q as Dt,U as Y,T as bt,X as Ft,$ as vt,Y as Lt,Z as Tt,ap as Mt}from"./index-E1lsH67L.js";import{u as Pt}from"./useQueryClient-Ct9uGIH0.js";var v,o,k,b,U,T,O,W,M,P,I,D,w,j,F,A,_,tt,B,et,V,st,z,it,N,rt,$,at,X,nt,Z,Rt,yt,jt=(yt=class extends St{constructor(t,e){super();c(this,F);c(this,_);c(this,B);c(this,V);c(this,z);c(this,N);c(this,$);c(this,X);c(this,Z);c(this,v,void 0);c(this,o,void 0);c(this,k,void 0);c(this,b,void 0);c(this,U,void 0);c(this,T,void 0);c(this,O,void 0);c(this,W,void 0);c(this,M,void 0);c(this,P,void 0);c(this,I,void 0);c(this,D,void 0);c(this,w,void 0);c(this,j,new Set);this.options=e,d(this,v,t),d(this,O,null),this.bindMethods(),this.setOptions(e)}bindMethods(){this.refetch=this.refetch.bind(this)}onSubscribe(){this.listeners.size===1&&(s(this,o).addObserver(this),mt(s(this,o),this.options)?p(this,F,A).call(this):this.updateResult(),p(this,z,it).call(this))}onUnsubscribe(){this.hasListeners()||this.destroy()}shouldFetchOnReconnect(){return ht(s(this,o),this.options,this.options.refetchOnReconnect)}shouldFetchOnWindowFocus(){return ht(s(this,o),this.options,this.options.refetchOnWindowFocus)}destroy(){this.listeners=new Set,p(this,N,rt).call(this),p(this,$,at).call(this),s(this,o).removeObserver(this)}setOptions(t,e){const r=this.options,h=s(this,o);if(this.options=s(this,v).defaultQueryOptions(t),this.options.enabled!==void 0&&typeof this.options.enabled!="boolean")throw new Error("Expected enabled to be a boolean");p(this,X,nt).call(this),s(this,o).setOptions(this.options),r._defaulted&&!q(this.options,r)&&s(this,v).getQueryCache().notify({type:"observerOptionsUpdated",query:s(this,o),observer:this});const a=this.hasListeners();a&&gt(s(this,o),h,this.options,r)&&p(this,F,A).call(this),this.updateResult(e),a&&(s(this,o)!==h||this.options.enabled!==r.enabled||this.options.staleTime!==r.staleTime)&&p(this,_,tt).call(this);const l=p(this,B,et).call(this);a&&(s(this,o)!==h||this.options.enabled!==r.enabled||l!==s(this,w))&&p(this,V,st).call(this,l)}getOptimisticResult(t){const e=s(this,v).getQueryCache().build(s(this,v),t),r=this.createResult(e,t);return At(this,r)&&(d(this,b,r),d(this,T,this.options),d(this,U,s(this,o).state)),r}getCurrentResult(){return s(this,b)}trackResult(t,e){const r={};return Object.keys(t).forEach(h=>{Object.defineProperty(r,h,{configurable:!1,enumerable:!0,get:()=>(this.trackProp(h),e==null||e(h),t[h])})}),r}trackProp(t){s(this,j).add(t)}getCurrentQuery(){return s(this,o)}refetch({...t}={}){return this.fetch({...t})}fetchOptimistic(t){const e=s(this,v).defaultQueryOptions(t),r=s(this,v).getQueryCache().build(s(this,v),e);return r.isFetchingOptimistic=!0,r.fetch().then(()=>this.createResult(r,e))}fetch(t){return p(this,F,A).call(this,{...t,cancelRefetch:t.cancelRefetch??!0}).then(()=>(this.updateResult(),s(this,b)))}createResult(t,e){var lt;const r=s(this,o),h=this.options,a=s(this,b),l=s(this,U),m=s(this,T),C=t!==r?t.state:s(this,k),{state:y}=t;let n={...y},u=!1,f;if(e._optimisticResults){const g=this.hasListeners(),J=!g&&mt(t,e),Ot=g&&gt(t,r,e,h);(J||Ot)&&(n={...n,...Et(y.data,t.options)}),e._optimisticResults==="isRestoring"&&(n.fetchStatus="idle")}let{error:Q,errorUpdatedAt:x,status:R}=n;if(e.select&&n.data!==void 0)if(a&&n.data===(l==null?void 0:l.data)&&e.select===s(this,W))f=s(this,M);else try{d(this,W,e.select),f=e.select(n.data),f=pt(a==null?void 0:a.data,f,e),d(this,M,f),d(this,O,null)}catch(g){d(this,O,g)}else f=n.data;if(e.placeholderData!==void 0&&f===void 0&&R==="pending"){let g;if(a!=null&&a.isPlaceholderData&&e.placeholderData===(m==null?void 0:m.placeholderData))g=a.data;else if(g=typeof e.placeholderData=="function"?e.placeholderData((lt=s(this,P))==null?void 0:lt.state.data,s(this,P)):e.placeholderData,e.select&&g!==void 0)try{g=e.select(g),d(this,O,null)}catch(J){d(this,O,J)}g!==void 0&&(R="success",f=pt(a==null?void 0:a.data,g,e),u=!0)}s(this,O)&&(Q=s(this,O),f=s(this,M),x=Date.now(),R="error");const L=n.fetchStatus==="fetching",G=R==="pending",H=R==="error",ut=G&&L,ct=f!==void 0;return{status:R,fetchStatus:n.fetchStatus,isPending:G,isSuccess:R==="success",isError:H,isInitialLoading:ut,isLoading:ut,data:f,dataUpdatedAt:n.dataUpdatedAt,error:Q,errorUpdatedAt:x,failureCount:n.fetchFailureCount,failureReason:n.fetchFailureReason,errorUpdateCount:n.errorUpdateCount,isFetched:n.dataUpdateCount>0||n.errorUpdateCount>0,isFetchedAfterMount:n.dataUpdateCount>C.dataUpdateCount||n.errorUpdateCount>C.errorUpdateCount,isFetching:L,isRefetching:L&&!G,isLoadingError:H&&!ct,isPaused:n.fetchStatus==="paused",isPlaceholderData:u,isRefetchError:H&&ct,isStale:ot(t,e),refetch:this.refetch}}updateResult(t){const e=s(this,b),r=this.createResult(s(this,o),this.options);if(d(this,U,s(this,o).state),d(this,T,this.options),s(this,U).data!==void 0&&d(this,P,s(this,o)),q(r,e))return;d(this,b,r);const h={},a=()=>{if(!e)return!0;const{notifyOnChangeProps:l}=this.options,m=typeof l=="function"?l():l;if(m==="all"||!m&&!s(this,j).size)return!0;const S=new Set(m??s(this,j));return this.options.throwOnError&&S.add("error"),Object.keys(s(this,b)).some(C=>{const y=C;return s(this,b)[y]!==e[y]&&S.has(y)})};(t==null?void 0:t.listeners)!==!1&&a()&&(h.listeners=!0),p(this,Z,Rt).call(this,{...h,...t})}onQueryUpdate(){this.updateResult(),this.hasListeners()&&p(this,z,it).call(this)}},v=new WeakMap,o=new WeakMap,k=new WeakMap,b=new WeakMap,U=new WeakMap,T=new WeakMap,O=new WeakMap,W=new WeakMap,M=new WeakMap,P=new WeakMap,I=new WeakMap,D=new WeakMap,w=new WeakMap,j=new WeakMap,F=new WeakSet,A=function(t){p(this,X,nt).call(this);let e=s(this,o).fetch(this.options,t);return t!=null&&t.throwOnError||(e=e.catch(Ct)),e},_=new WeakSet,tt=function(){if(p(this,N,rt).call(this),dt||s(this,b).isStale||!ft(this.options.staleTime))return;const e=Qt(s(this,b).dataUpdatedAt,this.options.staleTime)+1;d(this,I,setTimeout(()=>{s(this,b).isStale||this.updateResult()},e))},B=new WeakSet,et=function(){return(typeof this.options.refetchInterval=="function"?this.options.refetchInterval(s(this,o)):this.options.refetchInterval)??!1},V=new WeakSet,st=function(t){p(this,$,at).call(this),d(this,w,t),!(dt||this.options.enabled===!1||!ft(s(this,w))||s(this,w)===0)&&d(this,D,setInterval(()=>{(this.options.refetchIntervalInBackground||wt.isFocused())&&p(this,F,A).call(this)},s(this,w)))},z=new WeakSet,it=function(){p(this,_,tt).call(this),p(this,V,st).call(this,p(this,B,et).call(this))},N=new WeakSet,rt=function(){s(this,I)&&(clearTimeout(s(this,I)),d(this,I,void 0))},$=new WeakSet,at=function(){s(this,D)&&(clearInterval(s(this,D)),d(this,D,void 0))},X=new WeakSet,nt=function(){const t=s(this,v).getQueryCache().build(s(this,v),this.options);if(t===s(this,o))return;const e=s(this,o);d(this,o,t),d(this,k,t.state),this.hasListeners()&&(e==null||e.removeObserver(this),t.addObserver(this))},Z=new WeakSet,Rt=function(t){Ut.batch(()=>{t.listeners&&this.listeners.forEach(e=>{e(s(this,b))}),s(this,v).getQueryCache().notify({query:s(this,o),type:"observerResultsUpdated"})})},yt);function xt(i,t){return t.enabled!==!1&&i.state.data===void 0&&!(i.state.status==="error"&&t.retryOnMount===!1)}function mt(i,t){return xt(i,t)||i.state.data!==void 0&&ht(i,t,t.refetchOnMount)}function ht(i,t,e){if(t.enabled!==!1){const r=typeof e=="function"?e(i):e;return r==="always"||r!==!1&&ot(i,t)}return!1}function gt(i,t,e,r){return(i!==t||r.enabled===!1)&&(!e.suspense||i.state.status!=="error")&&ot(i,e)}function ot(i,t){return t.enabled!==!1&&i.isStaleByTime(t.staleTime)}function At(i,t){return!q(i.getCurrentResult(),t)}function kt(i,t,e){const r=e||Pt(),h=E(()=>{const u=It(t);typeof u.enabled=="function"&&(u.enabled=u.enabled());const f=r.defaultQueryOptions(u);return f._optimisticResults=r.isRestoring.value?"isRestoring":"optimistic",f}),a=new i(r,h.value),l=Dt(a.getCurrentResult());let m=()=>{};Y(r.isRestoring,u=>{u||(m(),m=a.subscribe(f=>{bt(l,f)}))},{immediate:!0});const S=()=>{a.setOptions(h.value),bt(l,a.getCurrentResult())};Y(h,S),Ft(()=>{m()});const C=(...u)=>(S(),l.refetch(...u)),y=()=>new Promise((u,f)=>{let Q=()=>{};const x=()=>{if(h.value.enabled!==!1){a.setOptions(h.value);const R=a.getOptimisticResult(h.value);R.isStale?(Q(),a.fetchOptimistic(h.value).then(u,L=>{vt(h.value.throwOnError,[L,a.getCurrentQuery()])?f(L):u(a.getCurrentResult())})):(Q(),u(R))}};x(),Q=Y(h,x)});Y(()=>l.error,u=>{if(l.isError&&!l.isFetching&&vt(h.value.throwOnError,[u,a.getCurrentQuery()]))throw u});const n=Lt(Tt(l));for(const u in l)typeof l[u]=="function"&&(n[u]=l[u]);return n.suspense=y,n.refetch=C,n}function Wt(i,t){return kt(jt,i,t)}function Nt({isEnabled:i,queryFn:t,queryKey:e,staleTime:r=0}){const{data:h,error:a,isError:l,isLoading:m,isSuccess:S,refetch:C,suspense:y}=Wt({enabled:i,placeholderData:Q=>Q,queryFn:t,queryKey:E(()=>n()),staleTime:r});function n(){return typeof e=="object"&&"params"in e?[e.key,...Object.values(Mt(e.params))]:[e.key]}async function u(){await y()}async function f(){await C()}return{data:E(()=>h.value??null),error:E(()=>a.value),isError:E(()=>l.value),isLoading:E(()=>m.value),isSuccess:E(()=>S.value),refetch:f,suspense:u}}export{Nt as u};
