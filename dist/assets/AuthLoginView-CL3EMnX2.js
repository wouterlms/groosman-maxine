import{z as f,_ as E,o as d,c as A,s as v,d as w,g as y,p as b,w as i,e as n,u as t,I as S,x as p,G as $,W as U,f as g,t as h,y as k,h as D,A as F,B,b as V,E as C,H as N}from"./index-DTCFwqg6.js";import{u as T}from"./typedRouter.composable-CKm0Te44.js";import{_ as q,a as G}from"./AuthFormSubmitButton.vue_vue_type_script_setup_true_lang-Cy6UV80z.js";import{_ as R}from"./AppTypedRouterLink.vue_vue_type_script_setup_true_lang-v-Sb-Bfo.js";(function(){try{var s=typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{},e=new Error().stack;e&&(s._sentryDebugIds=s._sentryDebugIds||{},s._sentryDebugIds[e]="7a13316b-7eaf-4941-821f-537ae7130646",s._sentryDebugIdIdentifier="sentry-dbid-7a13316b-7eaf-4941-821f-537ae7130646")}catch{}})();const j=f.object({email:f.string().email(),password:f.string().min(1)}),z={},H={class:"flex flex-col gap-y-2"};function P(s,e){return d(),A("div",H,[v(s.$slots,"default")])}const W=E(z,[["render",P]]),J=w({__name:"AuthLoginForm",props:{form:{},lastLoggedInUser:{}},setup(s){var c;const e=s,{t:r}=y(),o=e.form.register("email",(c=e.lastLoggedInUser)==null?void 0:c.email),u=e.form.register("password");return(l,_)=>(d(),b(k,{form:l.form},{default:i(()=>[n(W,null,{default:i(()=>[n(t(S),p(t(o),{"is-required":!0,label:t(r)("form.fields.email"),placeholder:"email@example.com",type:"email"}),null,16,["label"]),n(t($),p(t(u),{"is-required":!0,label:t(r)("form.fields.password"),placeholder:t(r)("form.fields.password")}),null,16,["label","placeholder"]),n(R,{to:{name:"forgot-password"},class:"py-2"},{default:i(()=>[n(t(U),{class:"font-medium text-primary",variant:"subtext"},{default:i(()=>[g(h(t(r)("auth.login.forgot_password")),1)]),_:1})]),_:1})]),_:1}),n(q,{form:l.form},{default:i(()=>[g(h(t(r)("auth.login.log_in")),1)]),_:1},8,["form"])]),_:1},8,["form"]))}}),X=w({__name:"AuthLoginView",setup(s){const e=D(),{lastLoggedInUser:r}=F(e),{t:o}=y(),u=N(),c=T(),{form:l,onSubmitForm:_}=B({schema:j}),I=V(()=>r.value===null?o("auth.login.log_in"):o("auth.login.welcome_back_name",{name:r.value.firstName}));async function L(a){e.setLastLoginAttemptEmail(null),e.setLastLoggedInUser(a),await c.replace({name:"index"})}function x(a){if(a instanceof C)l.addErrors({password:{_errors:[o("auth.login.invalid_email_or_password")]}}),u.error({description:o("auth.login.error_toast.description"),title:o("auth.login.error_toast.title")});else throw a}return _(async a=>{try{await e.login(a);const m=await e.getCurrentUser();await L(m)}catch(m){x(m),e.setLastLoginAttemptEmail(a.email)}}),(a,m)=>(d(),b(G,{description:t(o)("auth.login.sign_in_to_continue"),title:I.value},{default:i(()=>[n(J,{form:t(l),"last-logged-in-user":t(r)},null,8,["form","last-logged-in-user"])]),_:1},8,["description","title"]))}});export{X as default};
